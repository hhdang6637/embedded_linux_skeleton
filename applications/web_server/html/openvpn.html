<style>

/* Style the tab */
.tab {
    overflow: hidden;
    border: 1px solid #ccc;
    background-color: #f1f1f1;
}
/* Style the buttons that are used to open the tab content */
.tab button {
    background-color: inherit;
    float: left;
    border: none;
    outline: none;
    cursor: pointer;
    padding: 14px 16px;
    transition: 0.3s;
}
/* Change background color of buttons on hover */
.tab button:hover {
    background-color: #ddd;
}
/* Create an active/current tablink class */
.tab button.active {
    background-color: #ccc;
}
/* Style the tab content */
.tabcontent {
    display: none;
    padding: 6px 12px;
    border: 1px solid #ccc;
    border-top: none;
}

.tabcontent {
    animation: fadeEffect 1s; /* Fading effect takes 1 second */
}

/* Go from zero to full opacity */
@keyframes fadeEffect {
    from {opacity: 0;}
    to {opacity: 1;}
}
</style>

<div class="container">
    <div class="tab">
        <button class="tablinks" onclick="openTab(event, 'VPN_CFG')">VPN Configuration</button>
        <button class="tablinks" onclick="openTab(event, 'CA_INFO')">CA & Server Informations</button>
        <button class="tablinks" onclick="openTab(event, 'CLIENT_INFO')">Client Informations</button>
    </div>
    <!-- Tab content -->
    <div id="VPN_CFG" class="tabcontent card">
        <div class="card-body">
            <h5 class="card-title text-center">VPN Configuration</h5>
            <form action="/json/openvpn_cfg" method="post" enctype="multipart/form-data" id="js-openvpn_setting-form">
                <div class="form-group">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="enable_vpn" name="enable_vpn">
                        <label class="form-check-label" for="enable_vpn">Enable VPN Server</label>
                    </div>
                </div>
                <div class="form-group">
                    <label for="port">Port:</label>
                    <input type="text" class="form-control" id="port" name="port" placeholder="Port">
                </div>
                <div class="row justify-content-md-center">
                    <button type="submit" class="btn btn-primary btn-lg">Apply</button>
                </div>
            </form>
        </div>
    </div>
    <div id="CA_INFO" class="tabcontent card">
        <div class="card-body">
            <h5 class="card-title text-center">CA and Server Certificate</h5>
            <form action="/json/openvpn_cert" method="post" enctype="multipart/form-data" id="js-openvpn_cert-form">
                <div class="form-group">
                    <label for="ca">CA:</label>
                    <input type="text" class="form-control" id="ca" name="ca" placeholder="CA name">
                </div>
                <div class="form-group">
                    <label for="server">Server:</label>
                    <input type="text" class="form-control" id="server" name="server" placeholder="Server name">
                </div>
                <div class="row justify-content-md-center">
                    <button type="submit" class="btn btn-primary btn-lg">Apply</button>
                </div>
            </form>
        </div>
    </div>
    <div id="CLIENT_INFO" class="tabcontent card">
        <div class="card-body">
            <h5 class="card-title text-center">Client Certificate</h5>
            <form method="post" enctype="multipart/form-data">
                <div class="form-group">
                    <label for="client_cert">Client Certificate:</label>
                    <input type="text" class="form-control" id="client_cert" name="client_cert" placeholder="Client Certificate">
                </div>
                <div class="btn-toolbar d-flex justify-content-center" role="toolbar" aria-label="Toolbar with button groups">
                    <div class="btn-group mr-2" role="group" aria-label="First group">
                        <button type="button" class="btn btn-primary btn-lg">Generate Config</button>
                    </div>
                    <div class="btn-group" role="group" aria-label="Third group">
                        <button type="button" class="btn btn-primary btn-lg">Download</button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <button class="tablinks" hidden onclick="openTab(event, 'VPN_CFG')" id="defaultOpen"></button>
</div>
<script>
$(function () {
    $("#myTopnav").find("a[href='/pages/openvpn']").addClass("active")
});

+ function($) {
    'use strict';

    $(document).ready(function(){
        showInfor();
    });

    function showInfor()
    {
        $.getJSON( "/json/openvpn_cfg", function(data) {
            var infor_conf = data.json_openvpn_config;
            $("#port").val(infor_conf.port);

            if (infor_conf.state == 1)
            {
                $("#enable_vpn").prop('checked', true);
            }
        });
    }

    var addUserForm = document.getElementById('js-openvpn_setting-form');

    addUserForm.addEventListener('submit', function(e) {
        e.preventDefault();
        post_form_data();
    })
}(jQuery);

function post_form_data()
{
    var port_vpn = document.getElementById("port").value;
    var state = document.getElementById("enable_vpn").checked;

    var formData = new FormData();
    formData.append('port_vpn', port_vpn);
    formData.append('state', 0);

    if (state == true)
    {
        formData.append('state', 1);
    }

    var xhr = new XMLHttpRequest();
    xhr.open('POST', '/json/openvpn_cfg', true);
    xhr.onload = function () {
        //TODO show the progress
    };

    xhr.send(formData);
}

function openTab(evt, tabName) {
    // Declare all variables
    var i, tabcontent, tablinks;

    // Get all elements with class="tabcontent" and hide them
    tabcontent = document.getElementsByClassName("tabcontent");
    for (i = 0; i < tabcontent.length; i++) {
        tabcontent[i].style.display = "none";
    }

    // Get all elements with class="tablinks" and remove the class "active"
    tablinks = document.getElementsByClassName("tablinks");
    for (i = 0; i < tablinks.length; i++) {
        tablinks[i].className = tablinks[i].className.replace(" active", "");
    }

    // Show the current tab, and add an "active" class to the button that opened the tab
    document.getElementById(tabName).style.display = "block";
    evt.currentTarget.className += " active";
}

document.getElementById("defaultOpen").click();

</script>
